{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app_cpaoffice/calendar_app_cpaoffice/src/app/api/saveEvent/route.ts"],"sourcesContent":["import { google } from \"googleapis\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\n\r\nconst SHEET_ID = process.env.SHEET_ID || \"\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { userId, start, end, engagement, activity, location, details } = await req.json();\r\n    const now = new Date();\r\n    now.setHours(now.getHours() + 9); // ✅ JSTに変換\r\n    const formattedNow = now.toISOString().replace(\"T\", \" \").substring(0, 19); // ✅ YYYY-MM-DD HH:MM:SS 形式\r\n\r\n    const auth = new google.auth.GoogleAuth({\r\n      credentials: {\r\n        type: \"service_account\",\r\n        project_id: process.env.GOOGLE_PROJECT_ID,\r\n        private_key: process.env.GOOGLE_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\r\n        client_email: process.env.GOOGLE_CLIENT_EMAIL,\r\n      },\r\n      scopes: [\"https://www.googleapis.com/auth/spreadsheets\"],\r\n    });\r\n\r\n    const sheets = google.sheets({ version: \"v4\", auth });\r\n\r\n    // ✅ `DataID` を取得し、現在の行数 +1 で設定\r\n    const sheetData = await sheets.spreadsheets.values.get({\r\n      spreadsheetId: SHEET_ID,\r\n      range: \"TimeSheet!A:A\", // A列（DataID）を取得\r\n    });\r\n\r\n    const existingIds = sheetData.data.values?.slice(1).map(row => parseInt(row[0], 10)).filter(num => !isNaN(num)) || [];\r\n    const newId = existingIds.length > 0 ? (Math.max(...existingIds) + 1).toString() : \"1\";\r\n    \r\n\r\n    // ✅ Users シートから `UserID` に対応する `User_Name` を取得\r\n    const usersResponse = await sheets.spreadsheets.values.get({\r\n      spreadsheetId: SHEET_ID,\r\n      range: \"Users!A:E\", // A列がUserID、E列がUser_Name\r\n    });\r\n    \r\n    const usersData = usersResponse.data.values || [];\r\n    const userRow = usersData.find(row => row[0] === userId);\r\n    const userName = userRow ? userRow[4] : \"Unknown\"; \r\n\r\n    await sheets.spreadsheets.values.append({\r\n      spreadsheetId: SHEET_ID,\r\n      range: \"TimeSheet!A:J\", // A列（DataID）を追加\r\n      valueInputOption: \"USER_ENTERED\",\r\n      requestBody: {\r\n        values: [[newId, formattedNow, userId, userName,start, end, engagement, activity, location, details]],\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Event saved successfully\", id: newId });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: (error as Error).message }, { status: 500 });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAGA,MAAM,WAAW,QAAQ,GAAG,CAAC,QAAQ,IAAI;AAElC,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;QACtF,MAAM,MAAM,IAAI;QAChB,IAAI,QAAQ,CAAC,IAAI,QAAQ,KAAK,IAAI,WAAW;QAC7C,MAAM,eAAe,IAAI,WAAW,GAAG,OAAO,CAAC,KAAK,KAAK,SAAS,CAAC,GAAG,KAAK,2BAA2B;QAEtG,MAAM,OAAO,IAAI,qJAAA,CAAA,SAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,aAAa;gBACX,MAAM;gBACN,YAAY,QAAQ,GAAG,CAAC,iBAAiB;gBACzC,aAAa,QAAQ,GAAG,CAAC,kBAAkB,EAAE,QAAQ,QAAQ;gBAC7D,cAAc,QAAQ,GAAG,CAAC,mBAAmB;YAC/C;YACA,QAAQ;gBAAC;aAA+C;QAC1D;QAEA,MAAM,SAAS,qJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;YAAE,SAAS;YAAM;QAAK;QAEnD,+BAA+B;QAC/B,MAAM,YAAY,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACrD,eAAe;YACf,OAAO;QACT;QAEA,MAAM,cAAc,UAAU,IAAI,CAAC,MAAM,EAAE,MAAM,GAAG,IAAI,CAAA,MAAO,SAAS,GAAG,CAAC,EAAE,EAAE,KAAK,OAAO,CAAA,MAAO,CAAC,MAAM,SAAS,EAAE;QACrH,MAAM,QAAQ,YAAY,MAAM,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,eAAe,CAAC,EAAE,QAAQ,KAAK;QAGnF,+CAA+C;QAC/C,MAAM,gBAAgB,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACzD,eAAe;YACf,OAAO;QACT;QAEA,MAAM,YAAY,cAAc,IAAI,CAAC,MAAM,IAAI,EAAE;QACjD,MAAM,UAAU,UAAU,IAAI,CAAC,CAAA,MAAO,GAAG,CAAC,EAAE,KAAK;QACjD,MAAM,WAAW,UAAU,OAAO,CAAC,EAAE,GAAG;QAExC,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACtC,eAAe;YACf,OAAO;YACP,kBAAkB;YAClB,aAAa;gBACX,QAAQ;oBAAC;wBAAC;wBAAO;wBAAc;wBAAQ;wBAAS;wBAAO;wBAAK;wBAAY;wBAAU;wBAAU;qBAAQ;iBAAC;YACvG;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAA4B,IAAI;QAAM;IAC5E,EAAE,OAAO,OAAO;QACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO,AAAC,MAAgB,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF","debugId":null}},
    {"offset": {"line": 329, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}