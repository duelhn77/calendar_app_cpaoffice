{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app_cpaoffice/calendar_app_cpaoffice/src/app/api/getUserPermissions/route.ts"],"sourcesContent":["// /api/getUserPermissions/route.ts\r\nimport { google } from \"googleapis\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nconst SHEET_ID = process.env.SHEET_ID || \"\";\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const userId = searchParams.get(\"userId\");\r\n\r\n    if (!userId) {\r\n      return NextResponse.json({ error: \"userId is required\" }, { status: 400 });\r\n    }\r\n\r\n    const auth = new google.auth.GoogleAuth({\r\n      credentials: {\r\n        type: \"service_account\",\r\n        project_id: process.env.GOOGLE_PROJECT_ID,\r\n        private_key: process.env.GOOGLE_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\r\n        client_email: process.env.GOOGLE_CLIENT_EMAIL,\r\n      },\r\n      scopes: [\"https://www.googleapis.com/auth/spreadsheets.readonly\"],\r\n    });\r\n\r\n    const sheets = google.sheets({ version: \"v4\", auth });\r\n\r\n    // 1. ヘッダー行を取得して、各列のインデックスを動的に特定する\r\n    const headerRes = await sheets.spreadsheets.values.get({\r\n      spreadsheetId: SHEET_ID,\r\n      range: \"Users!A1:Z1\",\r\n    });\r\n    const headers = headerRes.data.values?.[0] || [];\r\n\r\n    const colIndex = (name: string) => headers.indexOf(name);\r\n\r\n    const userIdIndex = colIndex(\"UserID\");\r\n    const exportAllIndex = colIndex(\"ExportAll\");\r\n    const viewReportIndex = colIndex(\"ViewReport\");\r\n    const viewUserReportIndex = colIndex(\"ViewUserReport\");\r\n    const viewDashboardIndex = colIndex(\"ViewDashboard\");\r\n\r\n    if ([userIdIndex, exportAllIndex, viewReportIndex, viewUserReportIndex, viewDashboardIndex].some(idx => idx === -1)) {\r\n      return NextResponse.json({ error: \"必要なカラムが見つかりません\" }, { status: 500 });\r\n    }\r\n\r\n    // 2. 全データを取得して該当ユーザーの行を探す\r\n    const res = await sheets.spreadsheets.values.get({\r\n      spreadsheetId: SHEET_ID,\r\n      range: \"Users!A2:Z\",\r\n    });\r\n\r\n    const rows = res.data.values || [];\r\n    const row = rows.find(r => r[userIdIndex] === userId);\r\n\r\n    if (!row) {\r\n      return NextResponse.json({ error: \"ユーザーが見つかりません\" }, { status: 404 });\r\n    }\r\n\r\n    const parseBool = (val?: string) => val?.trim().toUpperCase() === \"TRUE\";\r\n\r\n    const permissions = {\r\n      canExportAll: parseBool(row[exportAllIndex]),\r\n      canViewReport: parseBool(row[viewReportIndex]),\r\n      canViewUserReport: parseBool(row[viewUserReportIndex]),\r\n      canViewDashboard: parseBool(row[viewDashboardIndex]),\r\n    };\r\n\r\n    return NextResponse.json(permissions);\r\n  } catch (error) {\r\n    console.error(\"❌ getUserPermissions エラー:\", error);\r\n    return NextResponse.json({ error: (error as Error).message }, { status: 500 });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA,mCAAmC;;;;AACnC;AACA;;;AAEA,MAAM,WAAW,QAAQ,GAAG,CAAC,QAAQ,IAAI;AAElC,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,CAAC,QAAQ;YACX,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,MAAM,OAAO,IAAI,qJAAA,CAAA,SAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,aAAa;gBACX,MAAM;gBACN,YAAY,QAAQ,GAAG,CAAC,iBAAiB;gBACzC,aAAa,QAAQ,GAAG,CAAC,kBAAkB,EAAE,QAAQ,QAAQ;gBAC7D,cAAc,QAAQ,GAAG,CAAC,mBAAmB;YAC/C;YACA,QAAQ;gBAAC;aAAwD;QACnE;QAEA,MAAM,SAAS,qJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;YAAE,SAAS;YAAM;QAAK;QAEnD,kCAAkC;QAClC,MAAM,YAAY,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACrD,eAAe;YACf,OAAO;QACT;QACA,MAAM,UAAU,UAAU,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,EAAE;QAEhD,MAAM,WAAW,CAAC,OAAiB,QAAQ,OAAO,CAAC;QAEnD,MAAM,cAAc,SAAS;QAC7B,MAAM,iBAAiB,SAAS;QAChC,MAAM,kBAAkB,SAAS;QACjC,MAAM,sBAAsB,SAAS;QACrC,MAAM,qBAAqB,SAAS;QAEpC,IAAI;YAAC;YAAa;YAAgB;YAAiB;YAAqB;SAAmB,CAAC,IAAI,CAAC,CAAA,MAAO,QAAQ,CAAC,IAAI;YACnH,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,0BAA0B;QAC1B,MAAM,MAAM,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YAC/C,eAAe;YACf,OAAO;QACT;QAEA,MAAM,OAAO,IAAI,IAAI,CAAC,MAAM,IAAI,EAAE;QAClC,MAAM,MAAM,KAAK,IAAI,CAAC,CAAA,IAAK,CAAC,CAAC,YAAY,KAAK;QAE9C,IAAI,CAAC,KAAK;YACR,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,YAAY,CAAC,MAAiB,KAAK,OAAO,kBAAkB;QAElE,MAAM,cAAc;YAClB,cAAc,UAAU,GAAG,CAAC,eAAe;YAC3C,eAAe,UAAU,GAAG,CAAC,gBAAgB;YAC7C,mBAAmB,UAAU,GAAG,CAAC,oBAAoB;YACrD,kBAAkB,UAAU,GAAG,CAAC,mBAAmB;QACrD;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO,AAAC,MAAgB,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF","debugId":null}},
    {"offset": {"line": 343, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}